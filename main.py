from FeatureExtraction.featureExtraction import featureExtraction
import sys
from FeatureSelection.featureSelection import featureSelection
from sklearn.metrics import classification_report
from Classifier.classifier import classifier
import os
import numpy as np

if __name__ == '__main__':
    extractor = featureExtraction("./new_feature.csv")
    path_benign = os.listdir("./DataBase/benign")
    path_benign = list(map(lambda x: "./DataBase/benign/" + x, path_benign))
    path_malware = os.listdir("./DataBase/malware/")
    path_malware = list(map(lambda x: "./DataBase/malware/" + x, path_malware))
    labels = [0] * len(path_benign) + [1] * len(path_malware)
    extractor.extract_sequence_feature(path_benign + path_malware, labels, "./dest/", apktool_bool=False)
    #extractor.extract_sequence_feature(["./DataBase/benign/1BAE5E333D769537D868A170ED7AACD4EC385B9DD347804CD46869ADB6B780B6.apk"], [1], "./dest/", apktool_bool=False)
    path = "./DataBase/benign/0FDA8183616674AFAC76DE4661DA0D38817E0E13409939F4CAAB7CF3A6980CD2.apk"
    dest = "./dest/"
    dir = dest + path.split('/')[-1].split('.')[0]
    #extractor.reverse_engineering_jar(path, dir)
    #extractor.extract_sequence_feature(["../DataBase/benign/16CF85D716C7F747FB6A2EBD91CBFBBBEE0C1FF7BA8CC514FC1AE1899676E430.apk"], [1], "./dest/")
    sys.exit(0)
    data = featureExtraction.read_csv("./test.csv")
    a = featureSelection(*data)
    print(a.X.shape)
    # selector, res = a.variance_selection()
    # print(res.shape)
    # print(a.X_header[selector.get_support()])
    # selector, res = a.Kbest_selection()
    # print(res.shape)
    # selector, res = a.select_percentile()
    # print(res.shape)
    selector, res = a.select_from_model()
    # selector, res = a.recursive_selector()
    print(res.shape)
    classifier = classifier(res, data[2])
    reg, score = classifier.linear_regression()
    reg, score = classifier.random_forest()
    reg, score = classifier.J48()
    reg, score = classifier.MLP()
